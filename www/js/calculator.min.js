class Calc{data={};selection={};lang="en";targetContainer=null;totalContainer=null;constructor(e,t){this.targetContainer=e,this.totalContainer=t,this.lang=document.documentElement.lang,document.getElementById("calc-form").addEventListener("submit",(async e=>{let t=this.data.strings.message[this.lang];if(t=t.replace("{selection}",this.getSelectionText()),t=t.replace("{total}",this.getTotal()),document.querySelector('main form input[name="message"]').value=t,0===this.getTotal())return e.preventDefault(),void emptySelection();document.getElementById("calc-accept").checked||(e.preventDefault(),await confirmTerms()&&e.target.submit())}))}async build(e){this.data=await this.fetch(e);for(const e in this.data.categories){const t=this.data.categories[e],a=document.createElement("section"),n=document.createElement("h2");n.innerText=t.title[this.lang],a.appendChild(n);const i=document.createElement("div");i.classList.add("uk-child-width-1-1","uk-child-width-1-4@m"),i.setAttribute("uk-grid",""),a.appendChild(i),t.options.forEach((t=>{const n=document.createElement("article");n.style.backgroundImage=`url('${this.data.baseImgPath}${t.img}')`,n.addEventListener("click",(n=>{this.selection[e]=t,this.totalContainer.innerText=this.getTotal(),Array.from(a.querySelectorAll("article")).forEach((e=>{e.classList.remove("selected")})),n.target.classList.add("selected")}));const l=document.createElement("h3");l.innerText=t.title[this.lang],n.appendChild(l);const c=document.createElement("span");c.innerHTML=`${t.price} &euro;`,n.appendChild(c);const s=document.createElement("span");s.innerHTML=this.data.strings.selected[this.lang],s.classList.add("selected-label"),n.appendChild(s);const r=document.createElement("div");r.appendChild(n),i.appendChild(r)})),this.targetContainer.appendChild(a)}}getTotal(){let e=0;for(let t in this.selection){e+=this.selection[t].price}return e}getSelectionText(){let e="";for(let t in this.selection){const a=this.selection[t];0!==a.price&&(e+=`\n- ${this.data.categories[t].title[this.lang]}: ${a.title[this.lang]} (${a.price}â‚¬)`)}return e}async fetch(e){e+=`?${Date.now()}`;var t=null;try{if(!(t=await(await fetch(e)).json()))throw console.error("[calc] malformed data loaded:",t),"malformed data"}catch(t){return void console.error(`[calc] failed to load ${e}, reason: ${t}`)}return t}}